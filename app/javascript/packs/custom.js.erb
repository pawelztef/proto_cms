require('./slugify.js');
const categoriesMultiselect = require('./categories.js');

$(() => {
  generatePassword();
  avatarCustomUploadButton();
  createPageSlug();
  createCategorySlug();
  categoriesMultiselect();
});


let createPageSlug = function() {
  let pageName = document.getElementById("page_name");
  let slugName = document.getElementById("page_permalink");
  window.Pz.slugify(pageName, slugName);
}

let createCategorySlug = function() {
  var inputSource = document.querySelector('#category_name');
  var inputTarget = document.querySelector('#category_slug');
  window.Pz.slugify(inputSource, inputTarget);
}

  <%# TODO Extract methods to separate files %>

  let generatePassword = function() {
    let passwordButton = document.getElementById("password_button");
    if (passwordButton != null) {
      passwordButton.addEventListener("click", function(e) {
        e.preventDefault();
        e.stopPropagation();
        let token = Math.random().toString(36).slice(2);
        document.getElementById("user_password").value = token;
      });
    }
  }

let avatarCustomUploadButton = function() {
  let avatarRealInput = document.getElementById("user_avatar");
  let avatarCustomUploadButton = document.getElementById("avatar_button");
  let avatarCustomMetaInfo = document.getElementById("avatar_meta");

  if(avatarCustomUploadButton != null) {
    avatarCustomUploadButton.addEventListener("click", function(e) {
      e.preventDefault();
      e.stopPropagation();
      avatarRealInput.click();
    });
  }
  if(avatarRealInput != null) {
    avatarRealInput.addEventListener("change", function(e) {
      e.preventDefault();
      e.stopPropagation();
      avatarCustomMetaInfo.innerHTML = avatarRealInput.files[0].name;
    });
  }
}
