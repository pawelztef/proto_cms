require('./slugify.js');
require('./ajax_links.js');
require('./media.js');
const categoriesMultiselect = require('./categories.js');
const tagsMultiselect = require('./tags.js');

$(() => {
  generatePassword();
  avatarCustomUploadButton();
  createPageSlug();
  createTagSlug();
  createCategorySlug();
  createTagsMultiselect();
  createCategoriesMultiselect();
  deleteLinksInit();
  mediaCardsInit(); 
});


let createPageSlug = function() {
  let pageName = document.getElementById("page_name");
  let slugName = document.getElementById("page_permalink");
  window.Pz.slugify(pageName, slugName);
}
let createCategorySlug = function() {
  var inputSource = document.querySelector('#category_name');
  var inputTarget = document.querySelector('#category_slug');
  window.Pz.slugify(inputSource, inputTarget);
}
let createTagSlug = function() {
  var inputSource = document.querySelector('#tag_name');
  var inputTarget = document.querySelector('#tag_slug');
  window.Pz.slugify(inputSource, inputTarget);
}
let createTagsMultiselect = function() {
  const tags = gon.post_tags;
  tagsMultiselect(tags);
}
let createCategoriesMultiselect = function() {
  const categories = gon.post_categories;
  categoriesMultiselect(categories);
}

let deleteLinksInit = function() {
    deleteLinks = document.getElementsByClassName("pz-delete-media");
  window.Pz.ajaxMediaDelete(deleteLinks);
}

let mediaCardsInit = function() {
  mediaCards = document.getElementsByClassName("uk-card-media");
  window.Pz.mediaCardsInit(mediaCards);
}

let generatePassword = function() {
  let passwordButton = document.getElementById("password_button");
  if (passwordButton != null) {
    passwordButton.addEventListener("click", function(e) {
      e.preventDefault();
      e.stopPropagation();
      let token = Math.random().toString(36).slice(2);
      document.getElementById("user_password").value = token;
    });
  }
}

let avatarCustomUploadButton = function() {
  let avatarRealInput = document.getElementById("user_avatar");
  let avatarCustomUploadButton = document.getElementById("avatar_button");
  let avatarCustomMetaInfo = document.getElementById("avatar_meta");

  if(avatarCustomUploadButton != null) {
    avatarCustomUploadButton.addEventListener("click", function(e) {
      e.preventDefault();
      e.stopPropagation();
      avatarRealInput.click();
    });
  }
  if(avatarRealInput != null) {
    avatarRealInput.addEventListener("change", function(e) {
      e.preventDefault();
      e.stopPropagation();
      avatarCustomMetaInfo.innerHTML = avatarRealInput.files[0].name;
    });
  }
}
